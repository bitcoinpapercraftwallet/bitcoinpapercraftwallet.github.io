<!DOCTYPE HTML>
<html lang="en" ng-app="app">
<head>
	<meta charset="UTF-8">
	<title>Bitcoin Papercraft Wallet Generator</title>
    <style type="text/css">
        @media print {
            h1 {
                display:none;
            }
        }
    </style>
</head>
<body>
    <div ng-controller="papercraftController">
        <h1>Bitcoin Papercraft Wallet</h1>
        <canvas id="canvas" style="max-width:100%;"></canvas>

        <div>
            <h3>Address</h3>
            <img ng-src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=bitcoin:{{ address }}" />
            <p>{{ address }}</p>
        </div>
        <br />
        <div>
            <h3>Private Key</h3>
            <img ng-src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ privateKey }}" />
            <p>{{ privateKey }}</p>
        </div-->
    </div>

    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/bitcore-lib/bitcore-lib.min.js"></script>
    <script>
        'use strict';

        var app = angular.module("app", []);

        app.controller("papercraftController", function($http, $scope, $q) {
            var Bitcore = require('bitcore-lib')
              , privateKey = new Bitcore.PrivateKey()
              , privateKeyWIF = privateKey.toWIF()
              , publicKey = privateKey.publicKey
              , address = publicKey.toAddress().toString()
              , canvas = document.getElementById("canvas")
              , ctx = canvas.getContext("2d")
              , bg = new Image()
              , qrcodeAddress = new Image();

            $scope.privateKey = privateKeyWIF;
            $scope.address = address;

            canvas.width = 800;
            canvas.height = 650;

            bg.src = "papercraft-1.png";

            function getPapercraft() {
                var deferred = $q.defer();

                bg.onload = function() {
                    deferred.resolve(response.data);
                }

                return deferred.promise;
            }

            qrcodeAddress.src = "http://api.qrserver.com/v1/create-qr-code/?size=100x100&data=bitcoin:" + address;

            qrcodeAddress.onload = function() {
                $q.all([getPapercraft]).then(function(result) {
                    ctx.drawImage(bg, 0, 0);
                    ctx.drawImage(qrcodeAddress, 573, 86);
                });
            }
        });
    </script>
</body>
</html>
